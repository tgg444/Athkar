<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø°Ø§ÙƒØ± - Ø£Ø¨Ùˆ Ø§Ù„Ø­Ø³Ù† tgg4</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #10b981;
            --primary-dark: #064e3b;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --muted: #64748b;
            --border: #e2e8f0;
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
        }

        [data-theme="dark"] {
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f1f5f9;
            --muted: #94a3b8;
            --border: #334155;
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; flex-direction: column; transition: 0.3s; }

        /* Header Rights */
        .tgg4-banner { background: var(--primary); color: white; padding: 8px; text-align: center; font-size: 12px; font-weight: 800; z-index: 5000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }

        .app-header { padding: 15px 20px; background: var(--card); display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); }
        .app-header h1 { font-size: 19px; font-weight: 900; color: var(--primary); }

        .search-container { padding: 15px 20px; }
        .search-input-group { background: var(--card); display: flex; align-items: center; padding: 10px 15px; border-radius: 15px; border: 2px solid var(--primary); box-shadow: var(--shadow); }
        .search-input-group input { border: none; outline: none; width: 100%; background: transparent; color: var(--text); font-size: 15px; padding: 0 10px; }

        /* Content Area */
        .main-content { flex: 1; overflow-y: auto; padding: 10px 20px 200px; display: none; }
        .main-content.active { display: block; }

        .grid-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin-top: 15px; }
        .grid-item { background: var(--card); padding: 20px 5px; border-radius: 15px; text-align: center; font-size: 13px; font-weight: 700; box-shadow: var(--shadow); border: 1px solid var(--border); cursor: pointer; }
        
        .track-card { background: var(--card); margin-bottom: 12px; padding: 15px; border-radius: 20px; display: flex; align-items: center; box-shadow: var(--shadow); border: 1px solid var(--border); }
        .track-meta { flex: 1; margin-left: 10px; overflow: hidden; }
        .track-meta h4 { font-size: 14px; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .btn-play-sm { width: 42px; height: 42px; background: var(--primary); color: white; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; }

        /* Mini Player */
        .mini-player { position: fixed; bottom: 90px; left: 15px; right: 15px; background: var(--card); height: 75px; border-radius: 22px; display: none; align-items: center; padding: 0 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 2px solid var(--primary); z-index: 1000; }

        /* Full Player (Optimized) */
        .full-player { position: fixed; inset: 0; background: var(--bg); z-index: 4000; display: none; flex-direction: column; padding: 40px 25px; text-align: center; }
        .artwork-area { position: relative; width: 220px; height: 220px; margin: 40px auto; border-radius: 50px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); display: flex; align-items: center; justify-content: center; color: white; font-size: 80px; box-shadow: 0 20px 40px rgba(16,185,129,0.3); }
        
        /* New Loader & Action Button */
        .loading-inner { position: absolute; inset: 0; background: rgba(0,0,0,0.7); border-radius: 50px; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 10; }
        .spin { width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.2); border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        #btn-play-now { display: none; background: var(--primary); color: white; border: none; padding: 15px 35px; border-radius: 30px; font-weight: 800; margin-top: 20px; box-shadow: 0 0 20px var(--primary); cursor: pointer; }

        /* Correct RTL Progress Bar */
        .progress-box { margin: 35px 0; }
        .bar-container { width: 100%; height: 10px; background: var(--border); border-radius: 10px; position: relative; cursor: pointer; overflow: hidden; }
        .bar-fill { height: 100%; background: var(--primary); position: absolute; right: 0; top: 0; width: 0%; border-radius: 10px; }
        .time-labels { display: flex; justify-content: space-between; margin-top: 10px; font-size: 13px; font-weight: 800; color: var(--text); }

        .player-controls { display: flex; justify-content: center; align-items: center; gap: 40px; margin-top: 20px; }
        .main-play-btn { width: 85px; height: 85px; background: var(--primary); color: white; border-radius: 50%; border: none; font-size: 35px; box-shadow: 0 10px 25px rgba(16,185,129,0.4); cursor: pointer; }

        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: var(--card); display: flex; justify-content: space-around; padding: 12px 0 30px; border-top: 1px solid var(--border); z-index: 1000; }
        .nav-link { display: flex; flex-direction: column; align-items: center; gap: 5px; font-size: 11px; color: #94a3b8; cursor: pointer; transition: 0.3s; }
        .nav-link.active { color: var(--primary); font-weight: 900; }
    </style>
</head>
<body>

    <div class="tgg4-banner">tgg4 Ù†Ø³Ø£Ù„ÙƒÙ… Ø§Ù„Ø¯Ø¹Ø§Ø¡ Ù„ÙŠ ÙˆÙ„ÙˆØ§Ù„Ø¯ÙŠÙ‘ Ø¨Ø§Ù„ØªÙˆÙÙŠÙ‚</div>

    <header class="app-header">
        <div style="display:flex; gap:15px;">
            <i class="fas fa-moon" onclick="toggleDark()"></i>
            <i class="fas fa-info-circle" onclick="showInfo()"></i>
        </div>
        <h1>Ø°Ø§ÙƒØ±</h1>
        <i class="fas fa-clock" onclick="setTimer()"></i>
    </header>

    <div class="search-container">
        <div class="search-input-group">
            <i class="fas fa-search" style="color:var(--primary)" onclick="performSearch()"></i>
            <input type="text" id="qInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù‚Ø§Ø±Ø¦ Ø£Ùˆ Ø³ÙˆØ±Ø© Ø£Ùˆ Ø¯Ø¹Ø§Ø¡...">
        </div>
    </div>

    <!-- Views -->
    <main id="view-home" class="main-content active">
        <h4 style="color:var(--primary)">Ø£Ø¨Ø±Ø² Ø§Ù„Ù‚Ø±Ø§Ø¡</h4>
        <div class="grid-list">
            <div class="grid-item" onclick="quick('Ù…ÙŠØ«Ù… Ø§Ù„ØªÙ…Ø§Ø±')">Ù…ÙŠØ«Ù… Ø§Ù„ØªÙ…Ø§Ø±</div>
            <div class="grid-item" onclick="quick('Ø£Ø¨Ø§Ø°Ø± Ø§Ù„Ø­Ù„ÙˆØ§Ø¬ÙŠ')">Ø£Ø¨Ø§Ø°Ø± Ø§Ù„Ø­Ù„ÙˆØ§Ø¬ÙŠ</div>
            <div class="grid-item" onclick="quick('Ø¹Ø§Ù…Ø± Ø§Ù„ÙƒØ§Ø¸Ù…ÙŠ')">Ø¹Ø§Ù…Ø± Ø§Ù„ÙƒØ§Ø¸Ù…ÙŠ</div>
            <div class="grid-item" onclick="quick('Ø¨Ø§Ø³Ù… Ø§Ù„ÙƒØ±Ø¨Ù„Ø§Ø¦ÙŠ')">Ø¨Ø§Ø³Ù… Ø§Ù„ÙƒØ±Ø¨Ù„Ø§Ø¦ÙŠ</div>
            <div class="grid-item" onclick="quick('Ø¹Ø¨Ø¯ Ø§Ù„Ø­ÙŠ Ù‚Ù†Ø¨Ø±')">Ø¹Ø¨Ø¯ Ø§Ù„Ø­ÙŠ Ù‚Ù†Ø¨Ø±</div>
            <div class="grid-item" onclick="quick('Ù‡Ø§Ù†ÙŠ Ø§Ù„Ø®Ø²Ø¹Ù„ÙŠ')">Ù‡Ø§Ù†ÙŠ Ø§Ù„Ø®Ø²Ø¹Ù„ÙŠ</div>
        </div>
    </main>

    <main id="view-surahs" class="main-content"><div class="grid-list" id="surahGrid"></div></main>
    <main id="view-duas" class="main-content"><div class="grid-list" id="duaGrid"></div></main>
    <main id="view-favs" class="main-content"><div id="favList"></div></main>
    <main id="view-results" class="main-content"><div id="resList"></div></main>

    <!-- Mini Player -->
    <div id="miniPlayer" class="mini-player" onclick="openFull()">
        <div style="flex:1; overflow:hidden; margin-left:10px;">
            <div id="mTitle" style="font-size:13px; font-weight:800; white-space:nowrap; text-overflow:ellipsis; overflow:hidden;">Ø§Ø®ØªØ± ØªÙ„Ø§ÙˆØ©</div>
            <div style="font-size:10px; color:var(--primary); font-weight:800;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø§Ù„Ø¢Ù†...</div>
        </div>
        <button class="btn-play-sm" onclick="event.stopPropagation(); togglePlay()">
            <i class="fas fa-play" id="mIcon"></i>
        </button>
    </div>

    <!-- Full Player -->
    <div id="fullPlayer" class="full-player">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <i class="fas fa-chevron-down" style="font-size:28px; color:var(--primary)" onclick="closeFull()"></i>
            <div style="font-weight:900; color:var(--primary);">Ø°Ø§ÙƒØ±</div>
            <i class="fas fa-share-nodes" style="font-size:22px;" onclick="shareApp()"></i>
        </div>

        <div class="artwork-area">
            <i class="fas fa-quran"></i>
            <div id="playerLoader" class="loading-inner">
                <div class="spin"></div>
                <p style="color:white; font-size:12px; margin-top:15px; font-weight:bold;">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù…Ù„Ù...</p>
            </div>
        </div>

        <h2 id="fTitle" style="font-size:18px; font-weight:900;">-</h2>
        <button id="btn-play-now" onclick="forceAudio()">ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¢Ù†</button>

        <div class="progress-box">
            <div class="bar-container" id="pBar" onclick="seekAudio(event)">
                <div class="bar-fill" id="pFill"></div>
            </div>
            <div class="time-labels">
                <span id="cTime">00:00</span>
                <span id="tTime">00:00</span>
            </div>
        </div>

        <div class="player-controls">
            <i class="fas fa-backward-step" style="font-size:28px; color:var(--primary)" onclick="nextPrev(-1)"></i>
            <button class="main-play-btn" onclick="togglePlay()"><i class="fas fa-play" id="fIcon"></i></button>
            <i class="fas fa-forward-step" style="font-size:28px; color:var(--primary)" onclick="nextPrev(1)"></i>
        </div>

        <div style="margin-top:40px; display:flex; justify-content:space-around; align-items:center; color:var(--muted)">
            <div onclick="setSpeed()" style="cursor:pointer; font-weight:800;"><i class="fas fa-gauge-high"></i> <span id="speedVal">1.0x</span></div>
            <div onclick="toggleFav()" style="cursor:pointer; font-weight:800;"><i id="fHeart" class="far fa-heart"></i> Ø­ÙØ¸</div>
        </div>
    </div>

    <!-- Bottom Nav -->
    <nav class="bottom-nav">
        <div class="nav-link active" onclick="switchTab('home', this)"><i class="fas fa-home"></i><span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></div>
        <div class="nav-link" onclick="switchTab('surahs', this)"><i class="fas fa-book-open"></i><span>Ø§Ù„Ø³ÙˆØ±</span></div>
        <div class="nav-link" onclick="switchTab('duas', this)"><i class="fas fa-hands-praying"></i><span>Ø§Ù„Ø£Ø¯Ø¹ÙŠØ©</span></div>
        <div class="nav-link" onclick="switchTab('favs', this)"><i class="fas fa-heart"></i><span>Ø§Ù„Ù…ÙØ¶Ù„Ø©</span></div>
    </nav>

    <audio id="coreAudio" style="display:none"></audio>

    <script>
        const surahs = ["Ø§Ù„ÙØ§ØªØ­Ø©", "Ø§Ù„Ø¨Ù‚Ø±Ø©", "Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†", "Ø§Ù„Ù†Ø³Ø§Ø¡", "Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©", "Ø§Ù„Ø£Ù†Ø¹Ø§Ù…", "Ø§Ù„Ø£Ø¹Ø±Ø§Ù", "Ø§Ù„Ø£Ù†ÙØ§Ù„", "Ø§Ù„ØªÙˆØ¨Ø©", "ÙŠÙˆÙ†Ø³", "Ù‡ÙˆØ¯", "ÙŠÙˆØ³Ù", "Ø§Ù„Ø±Ø¹Ø¯", "Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…", "Ø§Ù„Ø­Ø¬Ø±", "Ø§Ù„Ù†Ø­Ù„", "Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡", "Ø§Ù„ÙƒÙ‡Ù", "Ù…Ø±ÙŠÙ…", "Ø·Ù‡", "Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡", "Ø§Ù„Ø­Ø¬", "Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†", "Ø§Ù„Ù†ÙˆØ±", "Ø§Ù„ÙØ±Ù‚Ø§Ù†", "Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡", "Ø§Ù„Ù†Ù…Ù„", "Ø§Ù„Ù‚ØµØµ", "Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª", "Ø§Ù„Ø±ÙˆÙ…", "Ù„Ù‚Ù…Ø§Ù†", "Ø§Ù„Ø³Ø¬Ø¯Ø©", "Ø§Ù„Ø£Ø­Ø²Ø§Ø¨", "Ø³Ø¨Ø£", "ÙØ§Ø·Ø±", "ÙŠØ³", "Ø§Ù„ØµØ§ÙØ§Øª", "Øµ", "Ø§Ù„Ø²Ù…Ø±", "ØºØ§ÙØ±", "ÙØµÙ„Øª", "Ø§Ù„Ø´ÙˆØ±Ù‰", "Ø§Ù„Ø²Ø®Ø±Ù", "Ø§Ù„Ø¯Ø®Ø§Ù†", "Ø§Ù„Ø¬Ø§Ø«ÙŠØ©", "Ø§Ù„Ø£Ø­Ù‚Ø§Ù", "Ù…Ø­Ù…Ø¯", "Ø§Ù„ÙØªØ­", "Ø§Ù„Ø­Ø¬Ø±Ø§Øª", "Ù‚", "Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª", "Ø§Ù„Ø·ÙˆØ±", "Ø§Ù„Ù†Ø¬Ù…", "Ø§Ù„Ù‚Ù…Ø±", "Ø§Ù„Ø±Ø­Ù…Ù†", "Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©", "Ø§Ù„Ø­Ø¯ÙŠØ¯", "Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©", "Ø§Ù„Ø­Ø´Ø±", "Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©", "Ø§Ù„ØµÙ", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†", "Ø§Ù„ØªØºØ§Ø¨Ù†", "Ø§Ù„Ø·Ù„Ø§Ù‚", "Ø§Ù„ØªØ­Ø±ÙŠÙ…", "Ø§Ù„Ù…Ù„Ùƒ", "Ø§Ù„Ù‚Ù„Ù…", "Ø§Ù„Ø­Ø§Ù‚Ø©", "Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬", "Ù†ÙˆØ­", "Ø§Ù„Ø¬Ù†", "Ø§Ù„Ù…Ø²Ù…Ù„", "Ø§Ù„Ù…Ø¯Ø«Ø±", "Ø§Ù„Ù‚ÙŠØ§Ù…Ø©", "Ø§Ù„Ø¥Ù†Ø³Ø§Ù†", "Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª", "Ø§Ù„Ù†Ø¨Ø£", "Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª", "Ø¹Ø¨Ø³", "Ø§Ù„ØªÙƒÙˆÙŠØ±", "Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±", "Ø§Ù„Ù…Ø·ÙÙÙŠÙ†", "Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚", "Ø§Ù„Ø¨Ø±ÙˆØ¬", "Ø§Ù„Ø·Ø§Ø±Ù‚", "Ø§Ù„Ø£Ø¹Ù„Ù‰", "Ø§Ù„ØºØ§Ø´ÙŠØ©", "Ø§Ù„ÙØ¬Ø±", "Ø§Ù„Ø¨Ù„Ø¯", "Ø§Ù„Ø´Ù…Ø³", "Ø§Ù„Ù„ÙŠÙ„", "Ø§Ù„Ø¶Ø­Ù‰", "Ø§Ù„Ø´Ø±Ø­", "Ø§Ù„ØªÙŠÙ†", "Ø§Ù„Ø¹Ù„Ù‚", "Ø§Ù„Ù‚Ø¯Ø±", "Ø§Ù„Ø¨ÙŠÙ†Ø©", "Ø§Ù„Ø²Ù„Ø²Ù„Ø©", "Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª", "Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©", "Ø§Ù„ØªÙƒØ§Ø«Ø±", "Ø§Ù„Ø¹ØµØ±", "Ø§Ù„Ù‡Ù…Ø²Ø©", "Ø§Ù„ÙÙŠÙ„", "Ù‚Ø±ÙŠØ´", "Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†", "Ø§Ù„ÙƒÙˆØ«Ø±", "Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†", "Ø§Ù„Ù†ØµØ±", "Ø§Ù„Ù…Ø³Ø¯", "Ø§Ù„Ø¥Ø®Ù„Ø§Øµ", "Ø§Ù„ÙÙ„Ù‚", "Ø§Ù„Ù†Ø§Ø³"];
        const duas = ["Ø¯Ø¹Ø§Ø¡ ÙƒÙ…ÙŠÙ„", "Ø¯Ø¹Ø§Ø¡ Ø§Ù„ØªÙˆØ³Ù„", "Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ù†Ø¯Ø¨Ø©", "Ø²ÙŠØ§Ø±Ø© Ø¹Ø§Ø´ÙˆØ±Ø§Ø¡", "Ø­Ø¯ÙŠØ« Ø§Ù„ÙƒØ³Ø§Ø¡", "Ø¯Ø¹Ø§Ø¡ Ø§Ù„ØµØ¨Ø§Ø­", "Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ø¹Ù‡Ø¯", "Ø²ÙŠØ§Ø±Ø© ÙˆØ§Ø±Ø«", "Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ø¬ÙˆØ´Ù† Ø§Ù„ÙƒØ¨ÙŠØ±", "Ø§Ù„Ù…Ù†Ø§Ø¬Ø§Ø© Ø§Ù„Ø´Ø¹Ø¨Ø§Ù†ÙŠØ©", "Ø²ÙŠØ§Ø±Ø© Ø£Ù…ÙŠÙ† Ø§Ù„Ù„Ù‡"];
        
        const audio = document.getElementById('coreAudio');
        let playlist = [];
        let activeIdx = -1;
        let favs = JSON.parse(localStorage.getItem('zakir_favs_v22')) || [];

        function init() {
            document.getElementById('surahGrid').innerHTML = surahs.map(s => `<div class="grid-item" onclick="quick('Ø³ÙˆØ±Ø© ${s}')">${s}</div>`).join('');
            document.getElementById('duaGrid').innerHTML = duas.map(d => `<div class="grid-item" onclick="quick('${d}')">${d}</div>`).join('');
            if(localStorage.getItem('zakir_theme') === 'dark') document.body.setAttribute('data-theme', 'dark');
            refreshFavs();
        }

        async function play(index, list) {
            playlist = list;
            activeIdx = index;
            const track = playlist[index];
            
            // 1. ÙØªØ­ ÙÙˆØ±ÙŠ Ù„Ù„Ù…Ø´ØºÙ„
            openFull();
            document.getElementById('fTitle').innerText = track.title;
            document.getElementById('mTitle').innerText = track.title;
            document.getElementById('miniPlayer').style.display = 'flex';
            
            const loader = document.getElementById('playerLoader');
            const forceBtn = document.getElementById('btn-play-now');
            loader.style.display = 'flex';
            forceBtn.style.display = 'none';

            try {
                // ğŸ›  ØªØ­Ø³ÙŠÙ† Ø¬Ù„Ø¨ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„ÙŠØªÙˆØ§ÙÙ‚ Ù…Ø¹ GitHub
                const response = await fetch("https://api.vidssave.com/api/contentsite_api/media/parse", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    referrerPolicy: "no-referrer",
                    body: `auth=20250901majwlqo&domain=api-ak.vidssave.com&origin=source&link=${encodeURIComponent(track.url)}`
                });
                
                const res = await response.json();
                const mp3 = res.data.resources.find(r => r.type === 'audio' || r.format === 'mp3').download_url;
                
                // âš¡ï¸ ØªØ­Ø±ÙŠØ± Ù…Ø­Ø±Ùƒ Ø§Ù„ØµÙˆØª
                audio.src = mp3.startsWith('//') ? 'https:' + mp3 : mp3;
                
                audio.play().then(() => {
                    loader.style.display = 'none';
                }).catch(() => {
                    // Ø¥Ø°Ø§ Ø§Ø¹ØªØ±Ø¶ Ø§Ù„Ù…ØªØµÙØ­
                    loader.style.display = 'none';
                    forceBtn.style.display = 'block';
                });

                // ğŸ“± Ù…Ø²Ø§Ù…Ù†Ø© Ø´Ø§Ø´Ø© Ø§Ù„Ù‚ÙÙ„ Ù„Ù…Ù†Ø¹ Ù‚ÙØ²Ø© Ø§Ù„Ù€ 6 Ø¯Ù‚Ø§Ø¦Ù‚
                if ('mediaSession' in navigator) {
                    navigator.mediaSession.metadata = new MediaMetadata({
                        title: track.title, artist: 'tgg4',
                        artwork: [{ src: 'https://via.placeholder.com/512/10b981/ffffff?text=tgg4', sizes: '512x512', type: 'image/png' }]
                    });
                    navigator.mediaSession.setActionHandler('seekto', (d) => { audio.currentTime = d.seekTime; syncSys(); });
                    navigator.mediaSession.setActionHandler('play', () => audio.play());
                    navigator.mediaSession.setActionHandler('pause', () => audio.pause());
                }
                updateFavIcon();
            } catch (e) {
                loader.style.display = 'none';
                alert("ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØµÙØ­ Chrome. ØªØ·ÙˆÙŠØ±: Ø£Ø¨Ùˆ Ø§Ù„Ø­Ø³Ù† tgg4");
            }
        }

        function forceAudio() { audio.play(); document.getElementById('btn-play-now').style.display = 'none'; }

        // Core Player Logic (Fixed Progress Bar)
        function syncSys() {
            if ('mediaSession' in navigator && 'setPositionState' in navigator.mediaSession) {
                if (audio.duration && isFinite(audio.duration)) {
                    navigator.mediaSession.setPositionState({
                        duration: audio.duration,
                        playbackRate: audio.playbackRate,
                        position: audio.currentTime
                    });
                }
            }
        }

        audio.onplaying = () => { document.getElementById('playerLoader').style.display = 'none'; };
        audio.onplay = () => { document.getElementById('fIcon').className = 'fas fa-pause'; document.getElementById('mIcon').className = 'fas fa-pause'; syncSys(); };
        audio.onpause = () => { document.getElementById('fIcon').className = 'fas fa-play'; document.getElementById('mIcon').className = 'fas fa-play'; };

        audio.ontimeupdate = () => {
            if(!audio.duration || isNaN(audio.duration)) return;
            const pct = (audio.currentTime / audio.duration) * 100;
            document.getElementById('pFill').style.width = pct + '%';
            document.getElementById('cTime').innerText = fmt(audio.currentTime);
            document.getElementById('tTime').innerText = fmt(audio.duration);
            if(Math.floor(audio.currentTime) % 2 === 0) syncSys();
        };

        function seekAudio(e) {
            const rect = document.getElementById('pBar').getBoundingClientRect();
            const x = e.clientX - rect.left;
            const pct = 1 - (x / rect.width); // RTL Fix
            audio.currentTime = pct * audio.duration;
            syncSys();
        }

        async function performSearch() {
            const q = document.getElementById('qInput').value.trim();
            if(!q) return;
            switchTab('results', null);
            document.getElementById('resList').innerHTML = '<p style="text-align:center; padding:30px; opacity:0.5;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¨ÙˆØ§Ø³Ø·Ø© tgg4...</p>';
            try {
                const response = await fetch("https://vidssave.com/api/proxy", {
                    method: "POST", headers: { "Content-Type": "application/json" }, referrerPolicy: "no-referrer",
                    body: JSON.stringify({ url: "/media/hot_list", data: { hot_type: "ytb", keyword: q } })
                });
                const data = await response.json();
                const items = data.data.items || [];
                document.getElementById('resList').innerHTML = items.map((item, index) => `
                    <div class="track-card">
                        <div class="track-meta" onclick='play(${index}, ${JSON.stringify(items).replace(/'/g, "&apos;")})'>
                            <h4>${item.title}</h4>
                        </div>
                        <button class="btn-play-sm" onclick='play(${index}, ${JSON.stringify(items).replace(/'/g, "&apos;")})'><i class="fas fa-play"></i></button>
                    </div>
                `).join('');
            } catch (e) { }
        }

        // Helpers
        function fmt(s) { if(isNaN(s)) return "00:00"; const m = Math.floor(s/60), sec = Math.floor(s%60); return (m<10?'0'+m:m)+':'+(sec<10?'0'+sec:sec); }
        function togglePlay() { audio.paused ? audio.play() : audio.pause(); }
        function switchTab(id, el) {
            document.querySelectorAll('.main-content').forEach(v => v.classList.remove('active'));
            document.getElementById('view-' + id).classList.add('active');
            if(el) { document.querySelectorAll('.nav-link').forEach(d => d.classList.remove('active')); el.classList.add('active'); }
        }
        function toggleDark() { const isD = document.body.hasAttribute('data-theme'); isD ? document.body.removeAttribute('data-theme') : document.body.setAttribute('data-theme', 'dark'); localStorage.setItem('zakir_theme', isD ? 'light' : 'dark'); }
        function toggleFav() { if(activeIdx === -1) return; const t = playlist[activeIdx]; const i = favs.findIndex(f => f.url === t.url); i > -1 ? favs.splice(i, 1) : favs.push(t); localStorage.setItem('zakir_favs_v22', JSON.stringify(favs)); updateFavIcon(); refreshFavs(); }
        function updateFavIcon() { if(activeIdx === -1) return; const isF = favs.some(f => f.url === playlist[activeIdx].url); document.getElementById('fHeart').className = isF ? 'fas fa-heart' : 'far fa-heart'; document.getElementById('fHeart').style.color = isF ? 'red' : ''; }
        function refreshFavs() { document.getElementById('favList').innerHTML = favs.map((t, i) => `<div class="track-card"><div class="track-meta" onclick='play(${i}, ${JSON.stringify(favs).replace(/'/g, "&apos;")})'><h4>${t.title}</h4></div><button class="btn-play-sm" onclick='play(${i}, ${JSON.stringify(favs).replace(/'/g, "&apos;")})'><i class="fas fa-play"></i></button></div>`).join(favs.length?'':'<p style="text-align:center; padding-top:50px; opacity:0.5;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙØ¶Ù„Ø§Øª</p>'); }
        function quick(q) { document.getElementById('qInput').value = q; performSearch(); }
        function openFull() { document.getElementById('fullPlayer').style.display = 'flex'; }
        function closeFull() { document.getElementById('fullPlayer').style.display = 'none'; }
        function nextPrev(dir) { if(activeIdx+dir >= 0 && activeIdx+dir < playlist.length) play(activeIdx+dir, playlist); }
        function setSpeed() { const s = [1, 1.25, 1.5, 2, 0.75]; let n = s[(s.indexOf(audio.playbackRate) + 1) % s.length]; audio.playbackRate = n; document.getElementById('speedVal').innerText = n + 'x'; }
        function setTimer() { const m = prompt("Ø¥ÙŠÙ‚Ø§Ù Ø¨Ø¹Ø¯ (Ø¯Ù‚Ø§Ø¦Ù‚):", "30"); if(m) setTimeout(() => audio.pause(), m*60000); }
        function showInfo() { alert("Ø°Ø§ÙƒØ±\nØªØ·ÙˆÙŠØ±: Ø£Ø¨ÙˆØ§Ù„Ø­Ø³Ù† Ø¹Ø¨Ø¯Ø§Ù„Ù‡Ø§Ø¯ÙŠ tgg4\nÙ†Ø³Ø£Ù„ÙƒÙ… Ø§Ù„Ø¯Ø¹Ø§Ø¡ Ù„ÙŠ Ø¨Ø§Ù„ØªÙˆÙÙŠÙ‚ ÙˆØ§Ù„Ù‚Ø¨ÙˆÙ„."); }
        function shareApp() { alert("ØªØ·Ø¨ÙŠÙ‚ Ø°Ø§ÙƒØ± - tgg4\nØ´Ø§Ø±Ùƒ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¹ Ø£Ø­Ø¨Ø§Ø¨Ùƒ Ù„ØªØ¹Ù… Ø§Ù„ÙØ§Ø¦Ø¯Ø©."); }

        init();
        document.getElementById('qInput').onkeypress = (e) => { if(e.key === 'Enter') performSearch(); };
    </script>
</body>
</html>

 
