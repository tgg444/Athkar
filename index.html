<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ذاكر - تطوير أبو الحسن tgg4</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #10b981;
            --primary-dark: #064e3b;
            --accent: #f59e0b;
            --bg-body: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg-body: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --border: #334155;
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.4);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg-body); color: var(--text-main); height: 100vh; overflow: hidden; display: flex; flex-direction: column; transition: background 0.3s, color 0.3s; }

        /* Credits Bar */
        .credits-banner { background: var(--primary); color: white; padding: 8px; text-align: center; font-size: 12px; font-weight: 700; z-index: 2000; box-shadow: 0 2px 10px rgba(16, 185, 129, 0.2); }

        /* Header */
        .main-header { padding: 15px 20px; background: var(--card-bg); display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); z-index: 1000; }
        .main-header h1 { font-size: 20px; font-weight: 800; color: var(--primary); }
        .header-icons { display: flex; gap: 18px; font-size: 20px; cursor: pointer; }

        /* Search Area */
        .search-container { padding: 15px 20px; }
        .search-box { background: var(--card-bg); display: flex; align-items: center; padding: 10px 18px; border-radius: 18px; border: 2px solid var(--primary); box-shadow: var(--shadow); }
        .search-box input { border: none; outline: none; width: 100%; background: transparent; color: var(--text-main); font-size: 15px; padding: 0 10px; }

        /* Main Content Scroll */
        .content-scroll { flex: 1; overflow-y: auto; padding: 10px 20px 180px; display: none; scroll-behavior: smooth; }
        .content-scroll.active { display: block; }
        
        .section-title { margin: 15px 0; font-size: 16px; font-weight: 700; color: var(--primary); display: flex; align-items: center; gap: 8px; }

        /* Grid Layout */
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 12px; }
        .grid-card { background: var(--card-bg); padding: 18px 10px; border-radius: 16px; text-align: center; font-size: 13px; font-weight: 600; box-shadow: var(--shadow); border: 1px solid var(--border); transition: 0.2s; cursor: pointer; }
        .grid-card:active { transform: scale(0.92); background: var(--primary); color: white; }

        /* Track Item */
        .track-card { background: var(--card-bg); margin-bottom: 15px; padding: 15px; border-radius: 20px; display: flex; align-items: center; box-shadow: var(--shadow); border: 1px solid var(--border); transition: 0.3s; }
        .track-card:hover { border-color: var(--primary); }
        .track-info { flex: 1; margin-left: 12px; overflow: hidden; }
        .track-info h4 { font-size: 14px; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .track-info p { font-size: 11px; color: var(--text-muted); margin-top: 2px; }
        
        .play-icon-btn { width: 45px; height: 45px; background: var(--primary); color: white; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 16px; }

        /* Mini Player */
        .mini-player { position: fixed; bottom: 85px; left: 15px; right: 15px; background: var(--card-bg); height: 75px; border-radius: 22px; display: none; align-items: center; padding: 0 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 2px solid var(--primary); z-index: 1500; animation: slideUp 0.4s ease; }
        @keyframes slideUp { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* --- Full Page Player --- */
        .player-overlay { position: fixed; inset: 0; background: var(--bg-body); z-index: 3000; display: none; flex-direction: column; padding: 40px 25px; text-align: center; }
        .player-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .close-down { font-size: 28px; color: var(--primary); cursor: pointer; }

        .album-artwork { width: 220px; height: 220px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); margin: 20px auto 40px; border-radius: 50px; display: flex; align-items: center; justify-content: center; color: white; font-size: 90px; box-shadow: 0 20px 40px rgba(16, 185, 129, 0.3); position: relative; overflow: hidden; }
        
        /* New Smooth Progress Bar */
        .progress-wrapper { width: 100%; margin: 40px 0 20px; }
        .progress-bar-container { width: 100%; height: 10px; background: var(--border); border-radius: 20px; position: relative; cursor: pointer; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: var(--primary); position: absolute; right: 0; top: 0; width: 0%; border-radius: 20px; transition: width 0.1s linear; }
        .time-labels { display: flex; justify-content: space-between; margin-top: 12px; font-size: 14px; font-weight: 700; color: var(--text-main); }

        .controls-row { display: flex; justify-content: center; align-items: center; gap: 40px; margin-top: 20px; }
        .play-main-btn { width: 85px; height: 85px; background: var(--primary); color: white; border-radius: 50%; border: none; font-size: 35px; box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4); cursor: pointer; }
        .side-btn { font-size: 30px; color: var(--primary); cursor: pointer; opacity: 0.8; }

        .player-extras { display: flex; justify-content: space-around; margin-top: 50px; padding: 0 10px; }
        .extra-action { display: flex; flex-direction: column; align-items: center; gap: 8px; font-size: 12px; font-weight: 700; color: var(--text-muted); cursor: pointer; }
        .extra-action i { font-size: 20px; color: var(--primary); }

        /* Loader Overlay */
        .loading-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 5000; display: none; flex-direction: column; align-items: center; justify-content: center; color: white; backdrop-filter: blur(5px); }
        .loader-spin { width: 60px; height: 60px; border: 5px solid rgba(255,255,255,0.1); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s infinite linear; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        #forcePlayBtn { display: none; background: var(--primary); color: white; border: none; padding: 15px 40px; border-radius: 30px; font-weight: bold; margin-top: 25px; box-shadow: 0 0 20px var(--primary); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* Bottom Navigation */
        .bottom-navbar { position: fixed; bottom: 0; width: 100%; background: var(--card-bg); display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid var(--border); z-index: 1000; }
        .nav-tab { display: flex; flex-direction: column; align-items: center; gap: 4px; font-size: 11px; color: #94a3b8; cursor: pointer; transition: 0.3s; text-decoration: none; }
        .nav-tab.active { color: var(--primary); font-weight: 800; }
        .nav-tab i { font-size: 20px; }
    </style>
</head>
<body>

    <!-- Upper Credits -->
    <div class="credits-banner">تطوير: أبو الحسن tgg4 - نسألكم الدعاء بالتوفيق</div>

    <header class="main-header">
        <div class="header-icons">
            <i class="fas fa-moon" onclick="toggleDarkMode()"></i>
            <i class="fas fa-info-circle" onclick="showAbout()"></i>
        </div>
        <h1>ذاكر</h1>
        <i class="fas fa-hourglass-start" onclick="setTimer()"></i>
    </header>

    <div class="search-container">
        <div class="search-box">
            <i class="fas fa-search" style="color:var(--primary)" onclick="runSearch()"></i>
            <input type="text" id="searchInput" placeholder="ابحث عن قارئ أو سورة أو دعاء...">
        </div>
    </div>

    <!-- Page: Home -->
    <main id="page-home" class="content-scroll active">
        <div class="section-title"><i class="fas fa-star"></i> قراء مقترحون</div>
        <div class="grid-container">
            <div class="grid-card" onclick="quickSearch('ميثم التمار')">ميثم التمار</div>
            <div class="grid-card" onclick="quickSearch('أباذر الحلواجي')">أباذر الحلواجي</div>
            <div class="grid-card" onclick="quickSearch('عامر الكاظمي')">عامر الكاظمي</div>
            <div class="grid-card" onclick="quickSearch('باسم الكربلائي')">باسم الكربلائي</div>
            <div class="grid-card" onclick="quickSearch('هاني الخزعلي')">هاني الخزعلي</div>
            <div class="grid-card" onclick="quickSearch('عبد الحي قنبر')">عبد الحي قنبر</div>
        </div>
    </main>

    <!-- Page: Surahs (Full 114) -->
    <main id="page-surahs" class="content-scroll">
        <div class="section-title"><i class="fas fa-book-quran"></i> سور القرآن الكريم</div>
        <div class="grid-container" id="surahGrid"></div>
    </main>

    <!-- Page: Duas -->
    <main id="page-duas" class="content-scroll">
        <div class="section-title"><i class="fas fa-hands-praying"></i> الأدعية والزيارات</div>
        <div class="grid-container" id="duaGrid"></div>
    </main>

    <!-- Page: Favorites -->
    <main id="page-favs" class="content-scroll">
        <div class="section-title"><i class="fas fa-heart" style="color:red"></i> تلاواتك المفضلة</div>
        <div id="favList"></div>
    </main>

    <!-- Page: Results -->
    <main id="page-results" class="content-scroll">
        <div class="section-title"><i class="fas fa-list"></i> نتائج البحث</div>
        <div id="resultsList"></div>
    </main>

    <!-- Loading Screen -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loader-spin"></div>
        <p id="loaderMsg" style="margin-top:20px; font-weight:700;">جاري تشغيل ...</p>
        <button id="forcePlayBtn" onclick="manualPlay()">بدء التشغيل الآن</button>
        <p style="margin-top:40px; font-size:11px; opacity:0.6;">tgg4</p>
    </div>

    <!-- Mini Player -->
    <div id="miniPlayer" class="mini-player" onclick="openFullPlayer()">
        <div style="flex:1; overflow:hidden; margin-left:15px;">
            <div id="miniTitle" style="font-size:13px; font-weight:bold; white-space:nowrap; text-overflow:ellipsis; overflow:hidden;">لم يتم اختيار تلاوة</div>
            <div style="font-size:10px; color:var(--primary); font-weight:700;">جاري الاستماع الآن...</div>
        </div>
        <button class="play-icon-btn" onclick="event.stopPropagation(); togglePlay()">
            <i class="fas fa-play" id="miniPlayIcon"></i>
        </button>
    </div>

    <!-- Full Player Page -->
    <div id="fullPlayerPage" class="player-overlay">
        <div class="player-header">
            <i class="fas fa-chevron-down close-down" onclick="closeFullPlayer()"></i>
            <div style="font-weight:800; font-size:14px; color:var(--primary);"> ذاكر</div>
            <i class="fas fa-share-nodes" style="font-size:22px; color:var(--text-muted);" onclick="shareApp()"></i>
        </div>

        <div class="album-artwork"><i class="fas fa-quran"></i></div>
        
        <h2 id="fullPlayerTitle" style="font-size:18px; font-weight:800; padding:0 10px;">-</h2>
        <p style="font-size:12px; color:var(--primary); font-weight:700; margin-top:5px;"> tgg4</p>

        <div class="progress-wrapper">
            <div class="progress-bar-container" id="progressBar" onclick="handleSeek(event)">
                <div class="progress-bar-fill" id="progressFill"></div>
            </div>
            <div class="time-labels">
                <span id="currentTime">00:00</span>
                <span id="duration">00:00</span>
            </div>
        </div>

        <div class="controls-row">
            <i class="fas fa-backward-step side-btn" onclick="playPrevNext(-1)"></i>
            <button class="play-main-btn" onclick="togglePlay()">
                <i class="fas fa-play" id="mainPlayIcon"></i>
            </button>
            <i class="fas fa-forward-step side-btn" onclick="playPrevNext(1)"></i>
        </div>

        <div class="player-extras">
            <div class="extra-action" onclick="cycleSpeed()">
                <i class="fas fa-gauge-high"></i>
                <span id="speedDisplay">1.0x</span>
            </div>
            <div class="extra-action" id="favBtnMain" onclick="toggleCurrentFav()">
                <i class="far fa-heart" id="favHeartIcon"></i>
                <span>حفظ</span>
            </div>
            <div class="extra-action">
                <i class="fas fa-volume-high"></i>
                <input type="range" min="0" max="1" step="0.1" value="1" oninput="audio.volume = this.value" style="width:60px; accent-color:var(--primary)">
            </div>
        </div>
    </div>

    <!-- Bottom Nav -->
    <nav class="bottom-navbar">
        <div class="nav-tab active" onclick="switchPage('home', this)"><i class="fas fa-house"></i><span>الرئيسية</span></div>
        <div class="nav-tab" onclick="switchPage('surahs', this)"><i class="fas fa-book-open"></i><span>السور</span></div>
        <div class="nav-tab" onclick="switchPage('duas', this)"><i class="fas fa-hands-praying"></i><span>الأدعية</span></div>
        <div class="nav-tab" onclick="switchPage('favs', this)"><i class="fas fa-heart"></i><span>المفضلة</span></div>
    </nav>

    <audio id="mainAudio" style="display:none" preload="auto"></audio>

    <script>
        const surahs = ["الفاتحة", "البقرة", "آل عمران", "النساء", "المائدة", "الأنعام", "الأعراف", "الأنفال", "التوبة", "يونس", "هود", "يوسف", "الرعد", "إبراهيم", "الحجر", "النحل", "الإسراء", "الكهف", "مريم", "طه", "الأنبياء", "الحج", "المؤمنون", "النور", "الفرقان", "الشعراء", "النمل", "القصص", "العنكبوت", "الروم", "لقمان", "السجدة", "الأحزاب", "سبأ", "فاطر", "يس", "الصافات", "ص", "الزمر", "غافر", "فصلت", "الشورى", "الزخرف", "الدخان", "الجاثية", "الأحقاف", "محمد", "الفتح", "الحجرات", "ق", "الذاريات", "الطور", "النجم", "القمر", "الرحمن", "الواقعة", "الحديد", "المجادلة", "الحشر", "الممتحنة", "الصف", "الجمعة", "المنافقون", "التغابن", "الطلاق", "التحريم", "الملك", "القلم", "الحاقة", "المعارج", "نوح", "الجن", "المزمل", "المدثر", "القيامة", "الإنسان", "المرسلات", "النبأ", "النازعات", "عبس", "التكوير", "الانفطار", "المطففين", "الانشقاق", "البروج", "الطارق", "الأعلى", "الغاشية", "الفجر", "البلد", "الشمس", "الليل", "الضحى", "الشرح", "التين", "العلق", "القدر", "البينة", "الزلزلة", "العاديات", "القارعة", "التكاثر", "العصر", "الهمزة", "الفيل", "قريش", "الماعون", "الكوثر", "الكافرون", "النصر", "المسد", "الإخلاص", "الفلق", "الناس"];
        const duas = ["دعاء كميل", "دعاء التوسل", "دعاء الندبة", "زيارة عاشوراء", "حديث الكساء", "دعاء الصباح", "دعاء العهد", "زيارة وارث", "دعاء الجوشن الكبير", "المناجاة الشعبانية", "مناجاة التائبين", "زيارة أمين الله"];
        
        const audio = document.getElementById('mainAudio');
        let playlist = [];
        let currentIndex = -1;
        let favs = JSON.parse(localStorage.getItem('zakir_favs_v20')) || [];

        function init() {
            document.getElementById('surahGrid').innerHTML = surahs.map(s => `<div class="grid-card" onclick="quickSearch('سورة ${s}')">${s}</div>`).join('');
            document.getElementById('duaGrid').innerHTML = duas.map(d => `<div class="grid-card" onclick="quickSearch('${d}')">${d}</div>`).join('');
            if(localStorage.getItem('zakir_theme') === 'dark') document.body.setAttribute('data-theme', 'dark');
            refreshFavs();
        }

        async function playTrack(index, list) {
            playlist = list;
            currentIndex = index;
            const item = playlist[index];
            
            // UI Update
            document.getElementById('miniTitle').innerText = item.title;
            document.getElementById('fullPlayerTitle').innerText = item.title;
            document.getElementById('miniPlayer').style.display = 'flex';
            openFullPlayer();

            // Loader
            const loader = document.getElementById('loadingOverlay');
            const forceBtn = document.getElementById('forcePlayBtn');
            loader.style.display = 'flex';
            forceBtn.style.display = 'none';
            document.getElementById('loaderMsg').innerText = "جاري التشغيل ...";

            try {
                const response = await fetch("https://api.vidssave.com/api/contentsite_api/media/parse", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    referrerPolicy: "no-referrer",
                    body: `auth=20250901majwlqo&domain=api-ak.vidssave.com&origin=source&link=${encodeURIComponent(item.url)}`
                });
                
                const res = await response.json();
                const link = res.data.resources.find(r => r.type === 'audio' || r.format === 'mp3').download_url;
                
                audio.src = link.startsWith('//') ? 'https:' + link : link;
                
                // Autoplay attempt
                audio.play().then(() => {
                    loader.style.display = 'none';
                }).catch(() => {
                    loader.querySelector('.loader-spin').style.display = 'none';
                    document.getElementById('loaderMsg').innerText = "جاهز للتشغيل.. اضغط للبدء";
                    forceBtn.style.display = 'block';
                });

                // Media Session API (Background play & Lock screen)
                if ('mediaSession' in navigator) {
                    navigator.mediaSession.metadata = new MediaMetadata({
                        title: item.title, artist: 'أبو الحسن tgg4',
                        artwork: [{ src: 'https://via.placeholder.com/512/10b981/ffffff?text=tgg4', sizes: '512x512', type: 'image/png' }]
                    });
                    
                    navigator.mediaSession.setActionHandler('seekto', (details) => {
                        audio.currentTime = details.seekTime;
                        updateSystemPosition();
                    });
                    navigator.mediaSession.setActionHandler('play', () => audio.play());
                    navigator.mediaSession.setActionHandler('pause', () => audio.pause());
                    navigator.mediaSession.setActionHandler('previoustrack', () => playPrevNext(-1));
                    navigator.mediaSession.setActionHandler('nexttrack', () => playPrevNext(1));
                }
                updateFavIcon();
            } catch (e) {
                loader.style.display = 'none';
                alert("تعذر الاتصال. أبو الحسن ينصحك بفتح الرابط في متصفح Chrome.");
            }
        }

        function manualPlay() { audio.play(); document.getElementById('loadingOverlay').style.display = 'none'; }

        // Core Logic (Fixed Progress Bar)
        function updateSystemPosition() {
            if ('mediaSession' in navigator && 'setPositionState' in navigator.mediaSession) {
                if (audio.duration && isFinite(audio.duration)) {
                    navigator.mediaSession.setPositionState({
                        duration: audio.duration,
                        playbackRate: audio.playbackRate,
                        position: audio.currentTime
                    });
                }
            }
        }

        audio.onplaying = () => { document.getElementById('loadingOverlay').style.display = 'none'; };
        audio.onplay = () => { 
            document.getElementById('mainPlayIcon').className = 'fas fa-pause'; 
            document.getElementById('miniPlayIcon').className = 'fas fa-pause';
            updateSystemPosition();
        };
        audio.onpause = () => { 
            document.getElementById('mainPlayIcon').className = 'fas fa-play'; 
            document.getElementById('miniPlayIcon').className = 'fas fa-play';
        };

        audio.ontimeupdate = () => {
            if(!audio.duration || isNaN(audio.duration)) return;
            // Visual progress (RTL calculated)
            const pct = (audio.currentTime / audio.duration) * 100;
            document.getElementById('progressFill').style.width = pct + '%';
            document.getElementById('currentTime').innerText = formatTime(audio.currentTime);
            document.getElementById('duration').innerText = formatTime(audio.duration);
            
            // Sync with system every few seconds to prevent "6-min jump"
            if(Math.floor(audio.currentTime) % 2 === 0) updateSystemPosition();
        };

        function handleSeek(e) {
            const rect = document.getElementById('progressBar').getBoundingClientRect();
            // RTL Logic: Click position is relative to left, but bar starts from right
            const x = e.clientX - rect.left;
            const pct = 1 - (x / rect.width); 
            audio.currentTime = pct * audio.duration;
            updateSystemPosition();
        }

        async function performSearch() {
            const q = document.getElementById('searchInput').value.trim();
            if(!q) return;
            switchPage('results', null);
            document.getElementById('resultsList').innerHTML = '<p style="text-align:center; padding:20px;">جاري البحث عن تلاوات خاشعة...</p>';
            try {
                const response = await fetch("https://vidssave.com/api/proxy", {
                    method: "POST", headers: { "Content-Type": "application/json" }, referrerPolicy: "no-referrer",
                    body: JSON.stringify({ url: "/media/hot_list", data: { hot_type: "ytb", keyword: q } })
                });
                const data = await response.json();
                const items = data.data.items || [];
                document.getElementById('resultsList').innerHTML = items.map((item, index) => `
                    <div class="track-card">
                        <div class="track-info" onclick='playTrack(${index}, ${JSON.stringify(items).replace(/'/g, "&apos;")})'>
                            <h4>${item.title}</h4>
                            <p>بصوت كبار القراء</p>
                        </div>
                        <button class="play-icon-btn" onclick='playTrack(${index}, ${JSON.stringify(items).replace(/'/g, "&apos;")})'>
                            <i class="fas fa-play"></i>
                        </button>
                    </div>
                `).join('');
            } catch (e) { alert("حدث خطأ في البحث"); }
        }

        // Helper Functions
        function formatTime(s) { if(isNaN(s)) return "00:00"; const m = Math.floor(s/60), sec = Math.floor(s%60); return (m<10?'0'+m:m)+':'+(sec<10?'0'+sec:sec); }
        function togglePlay() { audio.paused ? audio.play() : audio.pause(); }
        function switchPage(id, el) {
            document.querySelectorAll('.content-scroll').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
            if(el) { document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active')); el.classList.add('active'); }
        }
        function toggleDarkMode() { 
            const isDark = document.body.hasAttribute('data-theme');
            isDark ? document.body.removeAttribute('data-theme') : document.body.setAttribute('data-theme', 'dark');
            localStorage.setItem('zakir_theme', isDark ? 'light' : 'dark');
        }
        function toggleCurrentFav() {
            if(currentIndex === -1) return;
            const item = playlist[currentIndex];
            const idx = favs.findIndex(f => f.url === item.url);
            idx > -1 ? favs.splice(idx, 1) : favs.push(item);
            localStorage.setItem('zakir_favs_v20', JSON.stringify(favs));
            updateFavIcon(); refreshFavs();
        }
        function updateFavIcon() {
            if(currentIndex === -1) return;
            const isFav = favs.some(f => f.url === playlist[currentIndex].url);
            document.getElementById('favHeartIcon').className = isFav ? 'fas fa-heart' : 'far fa-heart';
            document.getElementById('favHeartIcon').style.color = isFav ? 'red' : '';
        }
        function refreshFavs() {
            document.getElementById('favList').innerHTML = favs.map((item, index) => `
                <div class="track-card">
                    <div class="track-info" onclick='playTrack(${index}, ${JSON.stringify(favs).replace(/'/g, "&apos;")})'>
                        <h4>${item.title}</h4>
                    </div>
                    <button class="play-icon-btn" onclick='playTrack(${index}, ${JSON.stringify(favs).replace(/'/g, "&apos;")})'><i class="fas fa-play"></i></button>
                </div>
            `).join(favs.length ? '' : '<p style="text-align:center; opacity:0.6; padding-top:40px;">لا يوجد تلاوات في المفضلة</p>');
        }
        function quickSearch(q) { document.getElementById('searchInput').value = q; performSearch(); }
        function openFullPlayer() { document.getElementById('fullPlayerPage').style.display = 'flex'; }
        function closeFullPlayer() { document.getElementById('fullPlayerPage').style.display = 'none'; }
        function playPrevNext(dir) { if(currentIndex+dir >= 0 && currentIndex+dir < playlist.length) playTrack(currentIndex+dir, playlist); }
        function cycleSpeed() { const s = [1, 1.25, 1.5, 2, 0.75]; let next = s[(s.indexOf(audio.playbackRate) + 1) % s.length]; audio.playbackRate = next; document.getElementById('speedDisplay').innerText = next + 'x'; }
        function setTimer() { const m = prompt("إيقاف بعد (دقائق):", "30"); if(m) setTimeout(() => audio.pause(), m*60000); }
        function showAbout() { alert("تطبيق ذاكر\nتطوير: أبو الحسن tgg4\nنسألكم الدعاء لي بالتوفيق والقبول."); }
        function shareApp() { alert("رابط التطبيق من تطوير tgg4\nانسخ رابط الموقع من المتصفح وشاركه مع أحبابك."); }

        init();
        document.getElementById('searchInput').onkeypress = (e) => { if(e.key === 'Enter') performSearch(); };
    </script>
</body>
</html>

