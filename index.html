<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ذاكر - tgg4</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #10b981;
            --primary-dark: #064e3b;
            --bg-body: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --border: #e2e8f0;
            --shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.1);
        }

        [data-theme="dark"] {
            --bg-body: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f1f5f9;
            --border: #334155;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; transition: background 0.3s, color 0.3s; }
        body { background: var(--bg-body); color: var(--text-main); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* Credits Bar */
        .credits-top { background: var(--primary); color: white; padding: 5px; text-align: center; font-size: 11px; font-weight: bold; z-index: 2000; }

        /* Header */
        .header { padding: 12px 20px; background: var(--card-bg); display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); z-index: 1000; }
        .header h2 { font-size: 17px; color: var(--primary); font-weight: 700; }
        .header i { font-size: 20px; cursor: pointer; opacity: 0.8; }

        /* Search Bar */
        .search-area { padding: 10px 20px; }
        .search-bar { background: var(--card-bg); display: flex; align-items: center; padding: 10px 15px; border-radius: 12px; border: 1.5px solid var(--primary); box-shadow: var(--shadow); }
        .search-bar input { border: none; outline: none; width: 100%; background: transparent; color: var(--text-main); font-size: 14px; }

        /* Content Sections */
        .page-section { flex: 1; overflow-y: auto; padding: 10px 20px 180px; display: none; }
        .page-section.active { display: block; }
        .grid-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; }
        .grid-item { background: var(--card-bg); padding: 15px 5px; border-radius: 12px; text-align: center; font-size: 13px; box-shadow: var(--shadow); cursor: pointer; border: 1px solid var(--border); }

        /* Track Styles */
        .track-card { background: var(--card-bg); margin-bottom: 10px; padding: 15px; border-radius: 18px; display: flex; align-items: center; box-shadow: var(--shadow); border: 1px solid var(--border); }
        .track-info { flex: 1; margin-left: 10px; overflow: hidden; }
        .track-info h4 { font-size: 13.5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* Buttons */
        .btn-circle { width: 40px; height: 40px; background: var(--primary); color: white; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 14px; }

        /* Full Player */
        .player-page { position: fixed; inset: 0; background: var(--bg-body); z-index: 3000; display: none; flex-direction: column; padding: 40px 25px; text-align: center; }
        .art-disk { width: 180px; height: 180px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); margin: 30px auto; border-radius: 40px; display: flex; align-items: center; justify-content: center; color: white; font-size: 70px; box-shadow: 0 10px 30px rgba(16,185,129,0.3); }
        
        /* Progress Bar (RTL Fix) */
        .p-bar-bg { width: 100%; height: 8px; background: var(--border); border-radius: 10px; position: relative; cursor: pointer; margin: 25px 0; }
        .p-bar-fill { height: 100%; background: var(--primary); border-radius: 10px; width: 0%; position: absolute; right: 0; top: 0; pointer-events: none; }
        .time-row { display: flex; justify-content: space-between; font-size: 12px; font-weight: bold; margin-top: -10px; color: var(--text-main); }

        /* Mini Player */
        .mini-player { position: fixed; bottom: 85px; left: 15px; right: 15px; background: var(--card-bg); height: 65px; border-radius: 18px; display: none; align-items: center; padding: 0 15px; box-shadow: var(--shadow); border: 1.5px solid var(--primary); z-index: 950; }

        /* Smart Loader Overlay */
        .loading-screen { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 9000; display: none; flex-direction: column; align-items: center; justify-content: center; color: white; backdrop-filter: blur(4px); text-align: center; }
        .spinner { width: 50px; height: 50px; border: 4px solid rgba(255,255,255,0.1); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.7s infinite linear; margin-bottom: 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Bottom Nav */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: var(--card-bg); display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid var(--border); z-index: 1000; }
        .nav-link { display: flex; flex-direction: column; align-items: center; font-size: 11px; color: #94a3b8; cursor: pointer; text-decoration: none; }
        .nav-link.active { color: var(--primary); font-weight: bold; }

        /* Modal */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 9500; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal-box { background: var(--card-bg); padding: 25px; border-radius: 20px; text-align: center; max-width: 320px; }
        .modal-box h3 { color: var(--primary); margin-bottom: 10px; }
    </style>
</head>
<body>

    <div class="credits-top">تطوير: أبو الحسن عبدالهادي tgg4 - نسألكم الدعاء بالتوفيق</div>

    <div class="header">
        <div style="display:flex; gap:15px;">
            <i class="fas fa-adjust" onclick="toggleTheme()"></i>
            <i class="fas fa-info-circle" onclick="toggleModal(true)"></i>
        </div>
        <h2>ذاكر</h2>
        <i class="fas fa-stopwatch" onclick="setSleepTimer()"></i>
    </div>

    <div class="search-area">
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="ابحث عن قارئ، سورة، أو دعاء...">
            <i class="fas fa-search" onclick="performSearch()" style="color:var(--primary); cursor:pointer"></i>
        </div>
    </div>

    <!-- Page Sections -->
    <div id="home" class="page-section active">
        <h4 style="margin-bottom:12px; color:var(--primary)">أبرز القراء</h4>
        <div class="grid-list">
            <div class="grid-item" onclick="quickSearch('ميثم التمار')">ميثم التمار</div>
            <div class="grid-item" onclick="quickSearch('أباذر الحلواجي')">أباذر الحلواجي</div>
            <div class="grid-item" onclick="quickSearch('عامر الكاظمي')">عامر الكاظمي</div>
            <div class="grid-item" onclick="quickSearch('باسم الكربلائي')">باسم الكربلائي</div>
            <div class="grid-item" onclick="quickSearch('هاني الخزعلي')">هاني الخزعلي</div>
            <div class="grid-item" onclick="quickSearch('عبد الحي قنبر')">عبد الحي قنبر</div>
        </div>
    </div>

    <div id="surahs" class="page-section"><div class="grid-list" id="surahGrid"></div></div>
    <div id="duas" class="page-section"><div class="grid-list" id="duaGrid"></div></div>
    <div id="favorites" class="page-section"><div id="favArea"></div></div>
    <div id="results" class="page-section"><div id="resultsArea"></div></div>

    <!-- Smart Loader -->
    <div id="loader" class="loading-screen">
        <div class="spinner"></div>
        <p id="loaderMsg">جاري تشغيل...</p>
        <div style="margin-top:20px; font-size:11px; color:var(--primary)">بواسطة أبو الحسن tgg4</div>
    </div>

    <!-- Mini Player -->
    <div id="miniPlayer" class="mini-player" onclick="openFullPlayer()">
        <div style="flex:1; overflow:hidden">
            <div id="miniTitle" style="font-size:13px; font-weight:bold; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">اختر تلاوة</div>
        </div>
        <button class="btn-circle" id="miniPlayBtn" onclick="event.stopPropagation(); togglePlay()">
            <i class="fas fa-play"></i>
        </button>
    </div>

    <!-- Full Player -->
    <div id="playerPage" class="player-page">
        <i class="fas fa-chevron-down" onclick="closeFullPlayer()" style="font-size:26px; color:var(--primary); cursor:pointer"></i>
        <div class="art-disk"><i class="fas fa-mosque"></i></div>
        <h3 id="fullTitle">-</h3>
        
        <div class="p-bar-bg" id="progressBar" onclick="handleSeek(event)">
            <div class="p-bar-fill" id="progressFill"></div>
        </div>
        <div class="time-row">
            <span id="currentTime">00:00</span>
            <span id="duration">00:00</span>
        </div>
        
        <div style="display:flex; justify-content:center; gap:40px; align-items:center; margin-top:30px;">
            <i class="fas fa-backward-step" onclick="playNextPrev(-1)" style="font-size:28px; color:var(--primary); cursor:pointer"></i>
            <button class="btn-circle" style="width:75px; height:75px; font-size:30px" onclick="togglePlay()">
                <i class="fas fa-play" id="mainPlayIcon"></i>
            </button>
            <i class="fas fa-forward-step" onclick="playNextPrev(1)" style="font-size:28px; color:var(--primary); cursor:pointer"></i>
        </div>

        <div style="margin-top:40px; display:flex; justify-content:space-around; align-items:center; color:var(--text-main);">
            <div onclick="cycleSpeed()" style="cursor:pointer"><i class="fas fa-gauge"></i> <span id="speedTxt">1.0x</span></div>
            <div onclick="toggleCurrentFav()" style="cursor:pointer"><i id="favHeartFull" class="far fa-heart"></i> حفظ</div>
        </div>
    </div>

    <!-- About Modal -->
    <div id="infoModal" class="modal">
        <div class="modal-box">
            <h3>تطبيق ذاكر</h3>
            <p>تطوير وإعداد:<br><strong>أبو الحسن عبدالهادي tgg4</strong><br><br>نسألكم خالص الدعاء بالتوفيق والنجاح. تم العمل على هذا التطبيق كصدقة جارية.</p>
            <button class="btn-circle" style="width:100%; border-radius:10px; margin-top:15px;" onclick="toggleModal(false)">إغلاق</button>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-link active" onclick="switchSection('home', this)"><i class="fas fa-home"></i><span>الرئيسية</span></div>
        <div class="nav-link" onclick="switchSection('surahs', this)"><i class="fas fa-book-open"></i><span>السور</span></div>
        <div class="nav-link" onclick="switchSection('duas', this)"><i class="fas fa-hands-praying"></i><span>الأدعية</span></div>
        <div class="nav-link" onclick="switchSection('favorites', this)"><i class="fas fa-heart"></i><span>المفضلة</span></div>
    </div>

    <audio id="audioElement" style="display:none"></audio>

    <script>
        const surahs = ["الفاتحة", "البقرة", "آل عمران", "النساء", "المائدة", "الأنعام", "الأعراف", "الأنفال", "التوبة", "يونس", "هود", "يوسف", "الرعد", "إبراهيم", "الحجر", "النحل", "الإسراء", "الكهف", "مريم", "طه", "الأنبياء", "الحج", "المؤمنون", "النور", "الفرقان", "الشعراء", "النمل", "القصص", "العنكبوت", "الروم", "لقمان", "السجدة", "الأحزاب", "سبأ", "فاطر", "يس", "الصافات", "ص", "الزمر", "غافر", "فصلت", "الشورى", "الزخرف", "الدخان", "الجاثية", "الأحقاف", "محمد", "الفتح", "الحجرات", "ق", "الذاريات", "الطور", "النجم", "القمر", "الرحمن", "الواقعة", "الحديد", "المجادلة", "الحشر", "الممتحنة", "الصف", "الجمعة", "المنافقون", "التغابن", "الطلاق", "التحريم", "الملك", "القلم", "الحاقة", "المعارج", "نوح", "الجن", "المزمل", "المدثر", "القيامة", "الإنسان", "المرسلات", "النبأ", "النازعات", "عبس", "التكوير", "الانفطار", "المطففين", "الانشقاق", "البروج", "الطارق", "الأعلى", "الغاشية", "الفجر", "البلد", "الشمس", "الليل", "الضحى", "الشرح", "التين", "العلق", "القدر", "البينة", "الزلزلة", "العاديات", "القارعة", "التكاثر", "العصر", "الهمزة", "الفيل", "قريش", "الماعون", "الكوثر", "الكافرون", "النصر", "المسد", "الإخلاص", "الفلق", "الناس"];
        const duas = ["دعاء كميل", "دعاء التوسل", "دعاء الندبة", "زيارة عاشوراء", "حديث الكساء", "دعاء الصباح", "دعاء العهد", "زيارة وارث", "دعاء الجوشن الكبير", "المناجاة الشعبانية"];
        
        const audio = document.getElementById('audioElement');
        let currentPlaylist = [];
        let currentIndex = -1;
        let favorites = JSON.parse(localStorage.getItem('zakir_favs_v17')) || [];

        function init() {
            document.getElementById('surahGrid').innerHTML = surahs.map(s => `<div class="grid-item" onclick="quickSearch('سورة ${s}')">${s}</div>`).join('');
            document.getElementById('duaGrid').innerHTML = duas.map(d => `<div class="grid-item" onclick="quickSearch('${d}')">${d}</div>`).join('');
            if(localStorage.getItem('zakir_theme') === 'dark') document.body.setAttribute('data-theme', 'dark');
            renderFavorites();
        }

        async function playTrack(index) {
            currentIndex = index;
            const item = currentPlaylist[index];
            
            const loader = document.getElementById('loader');
            const loaderMsg = document.getElementById('loaderMsg');
            loader.style.display = 'flex';
            loaderMsg.innerText = "جاري تشغيل ...";

            document.getElementById('miniTitle').innerText = item.title;
            document.getElementById('fullTitle').innerText = item.title;
            document.getElementById('miniPlayer').style.display = 'flex';
            openFullPlayer();

            try {
                const response = await fetch("https://api.vidssave.com/api/contentsite_api/media/parse", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    referrerPolicy: "no-referrer", 
                    body: `auth=20250901majwlqo&domain=api-ak.vidssave.com&origin=source&link=${encodeURIComponent(item.url)}`
                });
                
                loaderMsg.innerText = "جاري استخراج الرابط...";
                const res = await response.json();
                const link = res.data.resources.find(r => r.type === 'audio' || r.format === 'mp3').download_url;
                
                audio.src = link.startsWith('//') ? 'https:' + link : link;
                loaderMsg.innerText = "بدء التشغيل...";
                
                audio.play().then(() => {
                    loader.style.display = 'none';
                }).catch(() => {
                    loader.style.display = 'none';
                    alert("يرجى النقر على تشغيل لبدء الصوت.");
                });

                if ('mediaSession' in navigator) {
                    navigator.mediaSession.metadata = new MediaMetadata({
                        title: item.title, artist: 'أبو الحسن tgg4',
                        artwork: [{ src: 'https://via.placeholder.com/512/10b981/ffffff?text=tgg4', sizes: '512x512', type: 'image/png' }]
                    });
                    navigator.mediaSession.setActionHandler('seekto', (details) => {
                        if (details.seekTime) audio.currentTime = details.seekTime;
                        syncSystem();
                    });
                }
            } catch (e) { 
                loader.style.display = 'none';
                alert("تعذر تشغيل الصوت.  ينصحك بمتصفح Chrome أو استخدام ملف محلي.");
            }
        }

        // Logic for RTL Seek and Position Sync
        function syncSystem() {
            if ('mediaSession' in navigator && 'setPositionState' in navigator.mediaSession) {
                if (audio.duration && isFinite(audio.duration)) {
                    navigator.mediaSession.setPositionState({
                        duration: audio.duration,
                        playbackRate: audio.playbackRate,
                        position: audio.currentTime
                    });
                }
            }
        }

        // Hide loader when audio starts moving
        audio.onplaying = () => { document.getElementById('loader').style.display = 'none'; };
        audio.onplay = () => { document.getElementById('mainPlayIcon').className = 'fas fa-pause'; syncSystem(); };
        audio.onpause = () => { document.getElementById('mainPlayIcon').className = 'fas fa-play'; };

        audio.ontimeupdate = () => {
            if(!audio.duration || isNaN(audio.duration)) return;
            const pct = (audio.currentTime / audio.duration) * 100;
            document.getElementById('progressFill').style.width = pct + '%';
            document.getElementById('currentTime').innerText = formatTime(audio.currentTime);
            document.getElementById('duration').innerText = formatTime(audio.duration);
            if(Math.floor(audio.currentTime) % 2 === 0) syncSystem();
        };

        function handleSeek(e) {
            const rect = document.getElementById('progressBar').getBoundingClientRect();
            const pct = 1 - ((e.clientX - rect.left) / rect.width);
            audio.currentTime = pct * audio.duration;
            syncSystem();
        }

        async function performSearch() {
            const q = document.getElementById('searchInput').value.trim();
            if(!q) return;
            switchSection('results', document.querySelectorAll('.nav-link')[0]);
            try {
                const response = await fetch("https://vidssave.com/api/proxy", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    referrerPolicy: "no-referrer",
                    body: JSON.stringify({ url: "/media/hot_list", data: { hot_type: "ytb", keyword: q } })
                });
                const data = await response.json();
                currentPlaylist = data.data.items || [];
                renderResults(currentPlaylist, 'resultsArea');
            } catch (e) { console.log(e); }
        }

        function renderResults(items, containerId) {
            document.getElementById(containerId).innerHTML = items.map((item, index) => {
                const isFav = favorites.some(f => f.url === item.url);
                return `
                <div class="track-card">
                    <div class="track-info" onclick="playTrack(${index})"><h4>${item.title}</h4></div>
                    <i class="${isFav?'fas':'far'} fa-heart" onclick="toggleFav(${index})" style="color:red; cursor:pointer; margin:0 10px;"></i>
                    <button class="btn-circle" onclick="playTrack(${index})"><i class="fas fa-play"></i></button>
                </div>
            `}).join('');
        }

        // Standard Helpers
        function formatTime(s) { const m = Math.floor(s/60), sec = Math.floor(s%60); return (m<10?'0'+m:m)+':'+(sec<10?'0'+sec:sec); }
        function togglePlay() { audio.paused ? audio.play() : audio.pause(); }
        function switchSection(id, el) {
            document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(el) { document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active')); el.classList.add('active'); }
        }
        function toggleTheme() {
            const isDark = document.body.hasAttribute('data-theme');
            isDark ? document.body.removeAttribute('data-theme') : document.body.setAttribute('data-theme', 'dark');
            localStorage.setItem('zakir_theme', isDark ? 'light' : 'dark');
        }
        function toggleModal(show) { document.getElementById('infoModal').style.display = show ? 'flex' : 'none'; }
        function toggleFav(idx) {
            const item = currentPlaylist[idx];
            const fIdx = favorites.findIndex(f => f.url === item.url);
            fIdx > -1 ? favorites.splice(fIdx, 1) : favorites.push(item);
            localStorage.setItem('zakir_favs_v17', JSON.stringify(favorites));
            renderResults(currentPlaylist, 'resultsArea');
            renderFavorites();
        }
        function toggleCurrentFav() {
            if(currentIndex === -1) return;
            const item = currentPlaylist[currentIndex];
            const fIdx = favorites.findIndex(f => f.url === item.url);
            fIdx > -1 ? favorites.splice(fIdx, 1) : favorites.push(item);
            localStorage.setItem('zakir_favs_v17', JSON.stringify(favorites));
            document.getElementById('favHeartFull').className = (fIdx > -1 ? 'far fa-heart' : 'fas fa-heart');
            renderFavorites();
        }
        function renderFavorites() { renderResults(favorites, 'favArea'); }
        function quickSearch(q) { document.getElementById('searchInput').value = q; performSearch(); }
        function openFullPlayer() { document.getElementById('playerPage').style.display = 'flex'; }
        function closeFullPlayer() { document.getElementById('playerPage').style.display = 'none'; }
        function playNextPrev(dir) { if(currentIndex+dir >= 0 && currentIndex+dir < currentPlaylist.length) playTrack(currentIndex+dir); }
        function cycleSpeed() {
            const s = [1, 1.25, 1.5, 2];
            let next = s[(s.indexOf(audio.playbackRate) + 1) % s.length];
            audio.playbackRate = next;
            document.getElementById('speedTxt').innerText = next + 'x';
        }
        function setSleepTimer() { const m = prompt("إيقاف بعد (دقائق):", "30"); if(m) setTimeout(() => audio.pause(), m*60000); }

        init();
        document.getElementById('searchInput').onkeypress = (e) => { if(e.key === 'Enter') performSearch(); };
    </script>
</body>
</html>

